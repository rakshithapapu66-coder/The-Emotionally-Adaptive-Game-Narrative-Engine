<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotional Journey</title>
    <style>
        :root {
            --calm-bg: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --anxious-bg: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%);
            --frustrated-bg: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
            --bored-bg: linear-gradient(135deg, #d9d9d9 0%, #f0f0f0 100%);
            --calm-text: #2c3e50;
            --anxious-text: #8e44ad;
            --frustrated-text: #c0392b;
            --bored-text: #7f8c8d;
            --calm-border: #3498db;
            --anxious-border: #9b59b6;
            --frustrated-border: #e74c3c;
            --bored-border: #95a5a6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--calm-bg);
            color: var(--calm-text);
            transition: all 0.5s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #3498db, #9b59b6, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .game-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-content {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .story-text {
            flex-grow: 1;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .choice-btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: #3498db;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .player-state-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .state-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .state-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .state-icon {
            font-size: 3rem;
            margin-right: 15px;
        }

        .state-name {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .state-calibrate {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .calibrate-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #2ecc71;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calibrate-btn:hover {
            background: #27ae60;
        }

        .metrics-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .metrics-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .visualization-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .visualization-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .emotion-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 2px solid #eee;
        }

        .emotion-bar {
            width: 40px;
            background: #3498db;
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }

        .emotion-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.8rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            background: #3498db;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .control-btn.reset {
            background: #e74c3c;
        }

        /* Emotion-specific styles */
        body.calm {
            background: var(--calm-bg);
            color: var(--calm-text);
        }

        body.anxious {
            background: var(--anxious-bg);
            color: var(--anxious-text);
        }

        body.frustrated {
            background: var(--frustrated-bg);
            color: var(--frustrated-text);
        }

        body.bored {
            background: var(--bored-bg);
            color: var(--bored-text);
        }

        .calm .choice-btn {
            background: var(--calm-border);
        }

        .anxious .choice-btn {
            background: var(--anxious-border);
        }

        .frustrated .choice-btn {
            background: var(--frustrated-border);
        }

        .bored .choice-btn {
            background: var(--bored-border);
        }

        .calm .emotion-bar {
            background: var(--calm-border);
        }

        .anxious .emotion-bar {
            background: var(--anxious-border);
        }

        .frustrated .emotion-bar {
            background: var(--frustrated-border);
        }

        .bored .emotion-bar {
            background: var(--bored-border);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body class="calm">
    <div class="container">
        <header>
            <h1>Emotional Journey</h1>
            <p class="subtitle">A game that adapts to your emotions in real-time</p>
        </header>

        <div class="game-area">
            <div class="game-content">
                <div class="story-text" id="storyText">
                    <p>You find yourself standing at the edge of an ancient forest. The trees loom tall and mysterious, their leaves whispering secrets in the wind. A narrow path winds its way into the darkness, and you feel a strange pull to follow it.</p>
                    <p>What do you do?</p>
                </div>
                <div class="choices">
                    <button class="choice-btn" data-choice="1">Follow the path into the forest</button>
                    <button class="choice-btn" data-choice="2">Stay where you are and observe your surroundings</button>
                </div>
            </div>

            <div class="player-state-panel">
                <h2 class="state-title">Your Emotional State</h2>
                <div class="state-indicator">
                    <div class="state-icon">ðŸ˜Š</div>
                    <div class="state-name" id="stateName">Calm</div>
                </div>
                <div class="state-details">
                    <p id="stateDescription">You're feeling relaxed and focused. The game will present you with thoughtful challenges and calming environments.</p>
                </div>
                <div class="state-calibrate">
                    <button class="calibrate-btn" id="calibrateBtn">Calibrate Emotion Detection</button>
                    <button class="calibrate-btn" id="webcamBtn">Enable Webcam Analysis</button>
                </div>
            </div>
        </div>

        <div class="metrics-panel">
            <h2 class="metrics-title">Emotion Detection Metrics</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="reactionTime">420ms</div>
                    <div class="metric-label">Reaction Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="mouseSpeed">2.4</div>
                    <div class="metric-label">Mouse Speed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="clickFrequency">0.8</div>
                    <div class="metric-label">Clicks/Min</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="hesitation">12%</div>
                    <div class="metric-label">Hesitation</div>
                </div>
            </div>
        </div>

        <div class="visualization-panel">
            <h2 class="visualization-title">Your Emotional Journey</h2>
            <div class="emotion-chart" id="emotionChart">
                <div class="emotion-bar" style="height: 70%;">
                    <div class="emotion-label">Calm</div>
                </div>
                <div class="emotion-bar" style="height: 30%;">
                    <div class="emotion-label">Anxious</div>
                </div>
                <div class="emotion-bar" style="height: 15%;">
                    <div class="emotion-label">Frustrated</div>
                </div>
                <div class="emotion-bar" style="height: 10%;">
                    <div class="emotion-label">Bored</div>
                </div>
            </div>
            <div class="controls">
                <button class="control-btn" id="restartBtn">Restart Game</button>
                <button class="control-btn reset" id="resetDataBtn">Reset Data</button>
            </div>
        </div>
    </div>

    <script>
        // Game state and emotion tracking
        const gameState = {
            currentScene: 0,
            playerState: 'calm',
            emotionHistory: ['calm'],
            metrics: {
                reactionTime: 420,
                mouseSpeed: 2.4,
                clickFrequency: 0.8,
                hesitation: 12
            },
            calibration: {
                baselineReactionTime: 400,
                baselineMouseSpeed: 2.0,
                baselineClickFrequency: 0.5
            }
        };

        // Narrative scenes with emotional variants
        const scenes = [
            {
                id: 0,
                calm: {
                    text: "You find yourself standing at the edge of an ancient forest. The trees loom tall and mysterious, their leaves whispering secrets in the wind. A narrow path winds its way into the darkness, and you feel a strange pull to follow it.",
                    choices: [
                        "Follow the path into the forest",
                        "Stay where you are and observe your surroundings"
                    ]
                },
                anxious: {
                    text: "You stand before a foreboding forest, shadows dancing between the twisted trees. The path ahead seems treacherous, and every sound makes your heart race. You feel an urgency to make a decision.",
                    choices: [
                        "Quickly follow the path before you lose your nerve",
                        "Hesitate and scan the area for threats"
                    ]
                },
                frustrated: {
                    text: "You're at the edge of this damn forest again. The path looks the same as before, and you're tired of these repetitive scenarios. Why can't something different happen for once?",
                    choices: [
                        "Storm into the forest out of irritation",
                        "Sit down and refuse to engage with this nonsense"
                    ]
                },
                bored: {
                    text: "You find yourself at the edge of yet another forest. The scenery is familiar and uninteresting. The path ahead looks predictable and you wonder if there's any point in continuing.",
                    choices: [
                        "Walk down the path with little enthusiasm",
                        "Look for something, anything, that might be different"
                    ]
                }
            },
            {
                id: 1,
                calm: {
                    text: "As you walk deeper into the forest, you notice the sunlight filtering through the canopy in beautiful patterns. A gentle breeze carries the scent of pine and earth. You feel at peace with your decision to explore.",
                    choices: [
                        "Continue following the path",
                        "Stop to appreciate the natural beauty"
                    ]
                },
                anxious: {
                    text: "The forest closes in around you, shadows lengthening with each step. Twigs snap in the distance, and your pulse quickens. You can't shake the feeling that you're being watched.",
                    choices: [
                        "Quickly move forward, hoping to find safety",
                        "Hide behind a large tree and listen carefully"
                    ]
                },
                frustrated: {
                    text: "The forest path seems to twist and turn without purpose. You're getting annoyed with the lack of clear direction. Every root seems placed specifically to trip you up.",
                    choices: [
                        "Push forward aggressively, knocking branches aside",
                        "Stop and loudly complain about the poor path design"
                    ]
                },
                bored: {
                    text: "You continue down the forest path, but nothing of interest catches your eye. The trees all look the same, and the path seems to stretch on forever without variation.",
                    choices: [
                        "Keep walking with little expectation",
                        "Try to find a shortcut to make things more interesting"
                    ]
                }
            }
        ];

        // Emotion descriptions
        const emotionData = {
            calm: {
                name: "Calm",
                description: "You're feeling relaxed and focused. The game will present you with thoughtful challenges and calming environments.",
                icon: "ðŸ˜Š"
            },
            anxious: {
                name: "Anxious",
                description: "You seem tense and hurried. The game will adjust to provide clearer guidance and reduce pressure.",
                icon: "ðŸ˜°"
            },
            frustrated: {
                name: "Frustrated",
                description: "You appear irritated by the challenges. The game will simplify obstacles and provide more assistance.",
                icon: "ðŸ˜ "
            },
            bored: {
                name: "Bored",
                description: "You seem disengaged. The game will introduce unexpected elements to recapture your interest.",
                icon: "ðŸ˜‘"
            }
        };

        // DOM elements
        const storyText = document.getElementById('storyText');
        const stateName = document.getElementById('stateName');
        const stateDescription = document.getElementById('stateDescription');
        const stateIcon = document.querySelector('.state-icon');
        const emotionChart = document.getElementById('emotionChart');
        const calibrateBtn = document.getElementById('calibrateBtn');
        const webcamBtn = document.getElementById('webcamBtn');
        const restartBtn = document.getElementById('restartBtn');
        const resetDataBtn = document.getElementById('resetDataBtn');

        // Initialize the game
        function initGame() {
            updateScene();
            setupEventListeners();
            startMetricsTracking();
            updateEmotionChart();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Choice buttons
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    handleChoice(parseInt(this.dataset.choice));
                });
            });

            // Control buttons
            calibrateBtn.addEventListener('click', calibrateEmotionDetection);
            webcamBtn.addEventListener('click', toggleWebcam);
            restartBtn.addEventListener('click', restartGame);
            resetDataBtn.addEventListener('click', resetData);
        }

        // Handle player choice
        function handleChoice(choice) {
            // Simulate emotional response based on choice and timing
            analyzeChoiceImpact(choice);
            
            // Advance to next scene
            gameState.currentScene++;
            if (gameState.currentScene >= scenes.length) {
                gameState.currentScene = 0; // Loop back for demo purposes
            }
            
            updateScene();
        }

        // Analyze how player choices might indicate emotional state
        function analyzeChoiceImpact(choice) {
            // In a real implementation, this would analyze:
            // - Time taken to make decision
            // - Mouse movement patterns during decision
            // - Previous emotional state
            
            // For demo, we'll simulate some emotional transitions
            const transitions = {
                calm: ['calm', 'anxious', 'calm', 'bored'],
                anxious: ['anxious', 'calm', 'frustrated', 'anxious'],
                frustrated: ['frustrated', 'calm', 'frustrated', 'bored'],
                bored: ['bored', 'calm', 'anxious', 'bored']
            };
            
            const currentState = gameState.playerState;
            const possibleStates = transitions[currentState];
            const newState = possibleStates[Math.floor(Math.random() * possibleStates.length)];
            
            setPlayerState(newState);
        }

        // Update the current scene based on player state
        function updateScene() {
            const scene = scenes[gameState.currentScene];
            const stateVariant = scene[gameState.playerState];
            
            storyText.innerHTML = `<p>${stateVariant.text}</p><p>What do you do?</p>`;
            
            // Update choice buttons
            const choiceButtons = document.querySelectorAll('.choice-btn');
            choiceButtons.forEach((btn, index) => {
                if (stateVariant.choices[index]) {
                    btn.textContent = stateVariant.choices[index];
                    btn.style.display = 'block';
                } else {
                    btn.style.display = 'none';
                }
            });
        }

        // Set the player's emotional state
        function setPlayerState(state) {
            gameState.playerState = state;
            gameState.emotionHistory.push(state);
            
            // Update UI
            document.body.className = state;
            stateName.textContent = emotionData[state].name;
            stateDescription.textContent = emotionData[state].description;
            stateIcon.textContent = emotionData[state].icon;
            
            // Update metrics display with simulated values
            updateMetricsDisplay();
            
            // Update emotion chart
            updateEmotionChart();
        }

        // Update metrics display with simulated data
        function updateMetricsDisplay() {
            // Simulate metric changes based on emotional state
            
            const stateMetrics = {
                calm: { reactionTime: 420, mouseSpeed: 2.4, clickFrequency: 0.8, hesitation: 12 },
                anxious: { reactionTime: 280, mouseSpeed: 4.2, clickFrequency: 1.5, hesitation: 5 },
                frustrated: { reactionTime: 350, mouseSpeed: 3.8, clickFrequency: 2.1, hesitation: 25 },
                bored: { reactionTime: 600, mouseSpeed: 1.2, clickFrequency: 0.3, hesitation: 40 }
            };
            
            const metrics = stateMetrics[gameState.playerState];
            document.getElementById('reactionTime').textContent = `${metrics.reactionTime}ms`;
            document.getElementById('mouseSpeed').textContent = metrics.mouseSpeed.toFixed(1);
            document.getElementById('clickFrequency').textContent = metrics.clickFrequency.toFixed(1);
            document.getElementById('hesitation').textContent = `${metrics.hesitation}%`;
            
            gameState.metrics = metrics;
        }

        // Update the emotion visualization chart
        function updateEmotionChart() {
            // Count occurrences of each emotion in history
            const emotionCounts = {
                calm: 0,
                anxious: 0,
                frustrated: 0,
                bored: 0
            };
            
            gameState.emotionHistory.forEach(emotion => {
                emotionCounts[emotion]++;
            });
            
            // Calculate percentages
            const total = gameState.emotionHistory.length;
            const calmPercent = (emotionCounts.calm / total) * 100;
            const anxiousPercent = (emotionCounts.anxious / total) * 100;
            const frustratedPercent = (emotionCounts.frustrated / total) * 100;
            const boredPercent = (emotionCounts.bored / total) * 100;
            
            // Update chart bars
            const bars = emotionChart.querySelectorAll('.emotion-bar');
            bars[0].style.height = `${calmPercent}%`;
            bars[1].style.height = `${anxiousPercent}%`;
            bars[2].style.height = `${frustratedPercent}%`;
            bars[3].style.height = `${boredPercent}%`;
        }

        // Start tracking player metrics
        function startMetricsTracking() {
            let lastMouseMove = 0;
            let mouseDistance = 0;
            let clickCount = 0;
            let startTime = Date.now();
            
            // Track mouse speed
            document.addEventListener('mousemove', (e) => {
                const now = Date.now();
                if (lastMouseMove > 0) {
                    const timeDiff = now - lastMouseMove;
                    if (timeDiff > 0) {
                        // Simple approximation of speed
                        mouseDistance += 1;
                    }
                }
                lastMouseMove = now;
            });
            
            // Track clicks
            document.addEventListener('click', () => {
                clickCount++;
            });
            
            // Update metrics periodically
            setInterval(() => {
                const currentTime = Date.now();
                const elapsedMinutes = (currentTime - startTime) / 60000;
                
                // Update metrics based on tracked data
                if (elapsedMinutes > 0) {
                    gameState.metrics.clickFrequency = clickCount / elapsedMinutes;
                    gameState.metrics.mouseSpeed = mouseDistance / elapsedMinutes;
                    
                    // Reset counters periodically
                    if (elapsedMinutes > 1) {
                        clickCount = 0;
                        mouseDistance = 0;
                        startTime = currentTime;
                    }
                    
                    updateMetricsDisplay();
                }
            }, 5000);
        }

        // Calibrate emotion detection (simulated)
        function calibrateEmotionDetection() {
            alert("Calibration started. Please interact normally with the game for the next 30 seconds to establish your baseline behavior.");
            
            // In a real implementation, this would:
            // 1. Record baseline metrics over a period
            // 2. Establish normal ranges for this player
            // 3. Adjust detection sensitivity
            
            // For demo, we'll just simulate calibration
            setTimeout(() => {
                alert("Calibration complete! Emotion detection is now personalized to your interaction style.");
            }, 2000);
        }

        // Toggle webcam analysis (simulated)
        function toggleWebcam() {
            if (webcamBtn.textContent.includes("Enable")) {
                alert("Webcam analysis enabled. The game will now use facial expression analysis to better understand your emotional state.");
                webcamBtn.textContent = "Disable Webcam Analysis";
            } else {
                alert("Webcam analysis disabled.");
                webcamBtn.textContent = "Enable Webcam Analysis";
            }
        }

        // Restart the game
        function restartGame() {
            gameState.currentScene = 0;
            gameState.emotionHistory = ['calm'];
            setPlayerState('calm');
            updateScene();
            updateEmotionChart();
        }

        // Reset all collected data
        function resetData() {
            if (confirm("Are you sure you want to reset all collected emotion data?")) {
                gameState.emotionHistory = ['calm'];
                gameState.metrics = {
                    reactionTime: 420,
                    mouseSpeed: 2.4,
                    clickFrequency: 0.8,
                    hesitation: 12
                };
                updateMetricsDisplay();
                updateEmotionChart();
                alert("Emotion data has been reset.");
            }
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>